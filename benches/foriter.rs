#![feature(test)]

use criterion::{black_box, criterion_group, criterion_main, Criterion};

static A: &'static [u32] = &[
    1279, 1950, 137, 9787, 6852, 8903, 4404, 983, 4394, 9375, 7366, 6074, 9461, 7338, 8670, 3399,
    3193, 72, 3423, 4885, 1703, 4306, 7301, 6576, 2458, 6551, 4783, 4054, 664, 6576, 4163, 4226,
    9513, 5510, 2466, 9914, 9325, 4694, 197, 8150, 5427, 9829, 2609, 7170, 5162, 3192, 9319, 4195,
    5619, 3828, 7388, 8934, 5546, 5140, 3419, 127, 6163, 8650, 5942, 8294, 8723, 7000, 9750, 1589,
    6724, 4301, 3460, 6665, 3300, 4086, 880, 7714, 4717, 4915, 5391, 1623, 3899, 2277, 587, 5591,
    3878, 2523, 9070, 1137, 2858, 1870, 1568, 8854, 3034, 861, 671, 9623, 3954, 5590, 6528, 177,
    989, 9897, 1591, 2828, 4490, 2799, 3903, 6034, 6853, 5602, 3070, 3669, 776, 4097, 6966, 4820,
    4582, 6392, 7430, 8752, 5351, 748, 3828, 7187, 141, 3600, 7909, 939, 6593, 6046, 9838, 8379,
    9254, 2276, 213, 1426, 6260, 1005, 9884, 178, 3138, 3581, 7629, 2643, 4155, 9129, 542, 1116,
    7920, 273, 9680, 4006, 5075, 9157, 3231, 4041, 8866, 3195, 6537, 5754, 2859, 7631, 1807, 144,
    3819, 8542, 6011, 4227, 4987, 1036, 9071, 5568, 2797, 2805, 9255, 5606, 8801, 5730, 9493, 1807,
    7448, 8073, 7861, 8034, 1265, 5221, 1379, 4938, 1159, 4771, 8580, 5587, 7643, 1238, 4880, 2614,
    8766, 2921, 4598, 5078, 719, 5377, 4187, 6299, 8138, 3690, 8724, 4378, 4054, 6374, 9728, 1600,
    3931, 1243, 3708, 3872, 6825, 826, 985, 6212, 5582, 1464, 3848, 6177, 5901, 3841, 2625, 6307,
    8959, 9696, 5242, 1830, 419, 5139, 8512, 9318, 2952, 5441, 2132, 7073, 6139, 9705, 9145, 347,
    6244, 8599, 3107, 7507, 6690, 5161, 3665, 707, 8101, 2308, 1519, 880, 7113, 4364, 3729, 5513,
    1567, 6285, 3653, 3120, 4003, 953, 2398, 594, 3323, 9889, 1226, 5045, 9424, 3842, 8532, 7865,
    348, 6170, 1591, 9739, 1456, 8588, 4529, 3815, 6898, 1848, 2416, 3015, 4099, 2927, 7344, 5674,
    7787, 4750, 5508, 8339, 5942, 7016, 6485, 6017, 7406, 6233, 7200, 4210, 4506, 8522, 8613, 3529,
    2344, 9998, 2713, 3899, 9983, 2089, 711, 539, 9318, 9021, 7349, 3174, 43, 5409, 9693, 788,
    4907, 4222, 562, 2541, 4107, 7683, 7638, 6547, 7046, 4792, 480, 1499, 135, 3375, 2682, 9477,
    5335, 5484, 3862, 4807, 3476, 9359, 4614, 2547, 5503, 2952, 2748, 7808, 1363, 1720, 5794, 3335,
    1579, 1236, 6922, 9741, 2482, 352, 9607, 1648, 6714, 679, 7315, 1401, 5410, 6481, 3013, 9525,
    5282, 4570, 7176, 199, 2434, 5816, 1710, 7080, 8737, 4524, 2600, 2300, 3073, 2873, 9260, 5237,
    7616, 9439, 9085, 9867, 6206, 4729, 9874, 1410, 5276, 6795, 2593, 5677, 5629, 9824, 1652, 99,
    4191, 6297, 5782, 3482, 9801, 8775, 3920, 1587, 6495, 9344, 7622, 8882, 2058, 1002, 5370, 3795,
    6386, 1712, 9716, 9207, 3517, 1215, 4211, 6240, 2278, 8013, 2549, 8872, 5829, 6980, 5382, 4408,
    3632, 2335, 3347, 4459, 3377, 5809, 2982, 3438, 9486, 8316, 8638, 2896, 9561, 532, 9433, 9762,
    1041, 9996, 8694, 9639, 3213, 2507, 7648, 3381, 2494, 1798, 1658, 1417, 9735, 2469, 9197, 9765,
    8357, 5467, 3140, 6393, 9293, 8064, 4135, 3262, 9956, 4247, 2969, 6233, 3980, 6391, 1250, 2917,
    6270, 6768, 9305, 6514, 4168, 2726, 4749, 3344, 4053, 1503, 9623, 9495, 8632, 7233, 8344, 8772,
    3548, 3424, 7518, 3303, 1616, 2678, 9728, 4536, 8677, 667, 8671, 4875, 8436, 4654, 9025, 4317,
    5548, 6991, 9182, 4327, 5839, 2685, 8251, 3975, 2042, 4466, 5955, 6884, 4015, 292, 7831, 8931,
    3723, 5088, 6577, 1816, 9880, 4870, 2224, 4931, 1964, 7569, 6109, 5744, 262, 5441, 319, 8836,
    5416, 2031, 4877, 9094, 8601, 8865, 4459, 1958, 8630, 4711, 3406, 2163, 6565, 9093, 7562, 9426,
    8245, 8314, 6444, 1248, 118, 9262, 9289, 1858, 6293, 885, 8909, 8196, 8847, 6363, 4487, 4718,
    5551, 9888, 4781, 1248, 7634, 9443, 4039, 5574, 7034, 8632, 8836, 6809, 7518, 6439, 731, 4733,
    7194, 5446, 8675, 7431, 1199, 6702, 8649, 2853, 2777, 6258, 9064, 3136, 533, 5045, 6209, 1456,
    8096, 525, 9108, 5211, 71, 5229, 4730, 9697, 4638, 4525, 4325, 5403, 6908, 1795, 9283, 3288,
    9495, 9133, 9299, 8793, 150, 104, 517, 7448, 461, 6282, 8824, 3715, 6867, 3293, 9132, 1875,
    5877, 3021, 8865, 9889, 7697, 5617, 5343, 3805, 4248, 7864, 5680, 265, 3705, 4385, 5839, 2107,
    1259, 148, 8037, 2534, 8774, 6759, 7947, 9940, 9449, 8935, 816, 6107, 5009, 3559, 3223, 5815,
    2395, 6081, 8375, 9519, 8315, 284, 9622, 5839, 5326, 2760, 6501, 3344, 634, 8314, 6249, 1050,
    7581, 3992, 8520, 4725, 5470, 6290, 8905, 5848, 3705, 4183, 5593, 9329, 2510, 9372, 9089, 7612,
    949, 828, 9075, 6098, 1702, 6958, 795, 7121, 4522, 7710, 2996, 4575, 6497, 2142, 157, 3501,
    3184, 9725, 9488, 4366, 1950, 4080, 2922, 8093, 9654, 4590, 3919, 1373, 1382, 3305, 5670, 5959,
    4128, 285, 8840, 2605, 998, 2330, 7762, 9792, 1367, 9194, 3827, 1657, 9668, 6012, 5064, 7066,
    6922, 4229, 3821, 7388, 1843, 2396, 3586, 9228, 7439, 3662, 2899, 8920, 3284, 6379, 1967, 3598,
    9970, 3943, 5795, 971, 5028, 7076, 9884, 1185, 886, 8022, 1641, 8403, 7689, 8630, 8854, 6476,
    5955, 7631, 1017, 3699, 4238, 1845, 6960, 8798, 2596, 5634, 8875, 3462, 7371, 9600, 9950, 5800,
    3494, 8013, 4974, 1571, 7880, 2127, 4079, 4427, 7140, 7199, 5807, 7658, 3182, 5647, 6804, 2987,
    6235, 7601, 7775, 2191, 2188, 4670, 6848, 298, 8550, 8452, 242, 3649, 3317, 5799, 4447, 2627,
    5766, 8680, 8614, 3924, 7627, 5439, 5490, 3135, 3655, 8877, 5530, 8077, 3520, 4379, 518, 8684,
    7663, 6747, 3130, 6504, 9015, 8010, 8421, 4181, 1216, 8187, 3810, 9134, 9484, 1913, 8905, 1880,
    6358, 257, 9045, 241, 3766, 5045, 3884, 7729, 7925, 9495, 7720, 5452, 3703, 337, 5243, 8976,
    6764, 9145, 5526, 444, 1735, 8932, 6088, 321, 7067, 4266, 6905, 6508, 4927, 6630, 1909, 1630,
    899, 7239, 7941, 9918, 5076, 7885, 7110, 9399, 2925, 7806, 434, 2755, 1239, 7671, 4194, 5212,
    1133, 4237, 9668, 9364, 3563, 1142, 3423, 5963, 481, 2375, 763, 9335, 7684, 3473, 1467, 5320,
    7770, 3350, 5716, 5894, 1868, 1312, 5748, 8123, 7873, 9411, 6504, 6517, 6653, 7323, 9394, 463,
    2018, 7286, 3112, 2614, 5857, 58, 6764, 8201, 759, 4710, 5642, 7577, 1709, 4489, 186, 8286,
    9166, 2559, 1816, 2761, 4769, 5150, 8568, 9424, 2129, 6224, 4598, 2057, 7705, 8550, 780, 5808,
    8452, 3864, 9686, 4296, 8044, 5125, 9927, 4958, 7393, 2885, 9960, 6121, 2925, 1854, 2030, 4612,
    383, 5114, 3184, 6944, 4807, 631, 3540, 6366,
];

fn for_index(a: &[u32]) {
    for i in 0..a.len() {
        let _: u32 = black_box(a[black_box(i)]);
    }
}
fn for_index2(a: &[u32]) {
    for i in 0..a.len() {
        let _: u32 = black_box(a[i]);
    }
}
fn for_each(a: &[u32]) {
    a.iter().for_each(|v| {
        let _: u32 = black_box(*v);
    });
}
fn for_iter(a: &[u32]) {
    for v in a.iter() {
        let _: u32 = black_box(*v);
    }
}
fn bench_foreach(c: &mut Criterion) {
    c.bench_function("for_each", |b| {
        b.iter(|| {
            for_each(black_box(A));
        })
    });
}
fn bench_foriter(c: &mut Criterion) {
    c.bench_function("for_iter", |b| {
        b.iter(|| {
            for_iter(black_box(A));
        })
    });
}
fn bench_forindex(c: &mut Criterion) {
    c.bench_function("for_index", |b| {
        b.iter(|| {
            for_index(black_box(A));
        })
    });
}
fn bench_forindex2(c: &mut Criterion) {
    c.bench_function("for_index2", |b| {
        b.iter(|| {
            for_index2(black_box(A));
        })
    });
}

criterion_group!(
    benches,
    bench_foreach,
    bench_foriter,
    bench_forindex,
    bench_forindex2
);
criterion_main!(benches);
